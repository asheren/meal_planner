<%- model_class = Recipe -%>

<div class="page-header d-flex justify-content-between align-items-center flex-wrap gap-3">
  <div>
    <h1>Scheduled Recipes</h1>
    <p class="subtitle">Meals planned for the upcoming days</p>
  </div>
  <%= link_to "Add New Recipe", new_recipe_path, class: 'btn btn-primary' %>
</div>

<div class="d-flex gap-3 mb-4">
  <%= link_to tag_path("medi") do %>
    <%= image_tag("medi.jpg", alt: "Filter by Meredith's meals", class: "profile-image") %>
  <% end %>
  <%= link_to tag_path("colin") do %>
    <%= image_tag("colin.jpg", alt: "Filter by Colin's meals", class: "profile-image") %>
  <% end %>
</div>

<% if @recipes.any? %>
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <% @recipes.sort_by(&:cook_on).each do |recipe| %>
      <div class="col">
        <div class="recipe-card">
          <div class="card-body d-flex flex-column">
            <div class="recipe-date">
              <%= recipe.cook_on&.strftime("%A, %B %d") %>
            </div>
            <h3 class="recipe-name">
              <%= link_to recipe.name, recipe_path(recipe), class: "text-decoration-none text-dark" %>
            </h3>
            <% if recipe.recipe_description.present? %>
              <p class="recipe-description"><%= truncate(recipe.recipe_description, length: 80) %></p>
            <% end %>
            <% if recipe.recipe_link.present? %>
              <p class="mb-2">
                <%= link_to recipe.recipe_link.truncate(30), ensure_protocol(recipe.recipe_link), target: "_blank", class: "recipe-link" %>
              </p>
            <% end %>
            <div class="mb-3">
              <% recipe.tag_list.each do |tag| %>
                <%= link_to tag, tag_path(tag), class: "tag-badge me-1" %>
              <% end %>
            </div>
            <div class="action-buttons mt-auto">
              <%= link_to "Edit", edit_recipe_path(recipe), class: 'btn btn-primary btn-sm' %>
              <%= link_to "Cooked", recipe_path(recipe, recipe: { cook_on: nil }), method: :put, class: 'btn btn-success btn-sm' %>
              <%= link_to "Delete", recipe_path(recipe), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm' %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="empty-state card-custom">
    <h3>No scheduled recipes</h3>
    <p>Add some recipes and schedule them to see them here!</p>
    <%= link_to "Add Your First Recipe", new_recipe_path, class: 'btn btn-primary' %>
  </div>
<% end %>
